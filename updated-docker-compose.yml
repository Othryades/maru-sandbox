networks:
  linea: {}

services:
  besu:
    image: hyperledger/besu:25.6.0
    container_name: linea-besu
    restart: unless-stopped
    networks: [linea]
    ports:
      - "8545:8545"        # JSON-RPC
      - "8550:8550"        # Engine API
      - "8551:8551"        # Engine API with auth (if needed)
      - "30303:30303"      # P2P TCP
      - "30303:30303/udp"  # P2P UDP
    environment:
      - JAVA_OPTS=-Xmx4g
      - PUBLIC_IP=${PUBLIC_IP}
    volumes:
      - ./besu/data:/opt/besu/data
      - ./besu/config/config.toml:/opt/besu/config.toml:ro
      - ./besu/genesis.json:/opt/besu/genesis.json:ro
    command:
      - --config-file=/opt/besu/config.toml

  maru:
    image: consensys/maru:013d64f
    container_name: linea-maru
    restart: unless-stopped
    depends_on:
      - besu
    networks: [linea]
    ports:
      - "8080:8080"         # Beacon/REST API
      - "31007:31007/tcp"   # P2P main port
      - "31007:31007/udp"   
      - "31008:31008/tcp"   # P2P discovery port
      - "31008:31008/udp"
      - "9090:9090"         # Metrics
    environment:
      - JAVA_OPTS=-Xmx2g
    volumes:
      - ./maru/config:/opt/consensys/maru/configs:ro
      - ./maru/data:/data
    command:
      - "java"
      - "-Dlog4j2.configurationFile=/opt/consensys/maru/configs/log4j.xml"
      - "-jar"
      - "/opt/consensys/maru/maru.jar"
      - "--maru-genesis-file"
      - "/opt/consensys/maru/configs/maru-genesis.json"
      - "--config"
      - "/opt/consensys/maru/configs/maru-config.toml"
